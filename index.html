<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio √âvolutif ‚Äì Algorithmique & Complexit√©</title>
  <style>
    :root{--bg:#f6f7fb;--card:#ffffff;--primary:#0b5cff;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0;background:var(--bg);color:#0f172a}
    header{background:linear-gradient(90deg,#0b5cff22,transparent);padding:28px 20px;border-bottom:1px solid #e6eefc}
    .wrap{max-width:1100px;margin:18px auto;padding:0 16px}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px;margin-top:4px}
    nav.top{display:flex;gap:12px;align-items:center;margin-top:14px;flex-wrap:wrap}
    .btn{background:var(--primary);color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600}
    .ghost{background:transparent;border:1px solid #d1e0ff;color:var(--primary)}

    .layout{display:grid;grid-template-columns:260px 1fr;gap:20px;margin-top:20px}
    aside{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(11,92,255,0.06)}
    .lesson-list{display:flex;flex-direction:column;gap:8px}
    .lesson-item{padding:8px 10px;border-radius:8px;cursor:pointer;color:#0b5cff}
    .lesson-item.active{background:#eef4ff}
    main{min-height:60vh}

    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.05);margin-bottom:18px}
    label{font-weight:700;font-size:13px}
    textarea,input[type=text],select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #e6eefc;background:#fbfdff}
    textarea{min-height:110px;resize:vertical}
    .row{display:flex;gap:12px}
    .row .col{flex:1}
    .meta{color:var(--muted);font-size:13px;margin-top:6px}
    .small{font-size:13px;color:var(--muted)}
    footer{padding:18px 0;color:var(--muted);text-align:center}

    .top-actions{display:flex;gap:8px;align-items:center}
    .controls{display:flex;gap:8px;margin-top:10px}
    @media(max-width:900px){.layout{grid-template-columns:1fr}.aside-hidden{display:none}}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>üìí Portfolio √âvolutif ‚Äì Algorithmique et Complexit√©</h1>
      <div class="subtitle">Template interactif ‚Äî sauvegarde locale (localStorage). Tu peux ajouter/modifier les le√ßons, exporter et int√©grer dans GitHub Pages.</div>
      <nav class="top">
        <div class="top-actions">
          <button id="addLessonBtn" class="btn">‚ûï Nouvelle le√ßon</button>
          <button id="exportJsonBtn" class="btn ghost">‚¨áÔ∏è Export JSON</button>
          <button id="downloadHtmlBtn" class="btn">üìÑ T√©l√©charger HTML</button>
        </div>
        <div style="margin-left:auto" class="small">Astuce : ton travail est sauvegard√© localement dans ton navigateur.</div>
      </nav>
    </div>
  </header>

  <section class="wrap layout">
    <aside id="sidebar">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Le√ßons</strong>
          <button id="resetBtn" class="ghost btn" style="padding:6px 8px">R√©initialiser</button>
        </div>
        <p class="meta">Clique sur une le√ßon pour l'√©diter. Les changements sont auto-enregistr√©s.</p>
      </div>
      <div class="card lesson-list" id="lessonsList"></div>
      <div class="card">
        <label>Importer JSON</label>
        <input id="importFile" type="file" accept="application/json" />
        <p class="small">Importer un export JSON pour restaurer un portfolio.</p>
      </div>
    </aside>

    <main>
      <div id="editorArea"></div>
      <div class="card">
        <h3>üîé Bilan final (√† remplir en fin de semestre)</h3>
        <label>1. Ce que j‚Äôai le plus appris</label>
        <textarea id="bilan1"></textarea>
        <label>2. Les comp√©tences que je peux r√©utiliser ailleurs</label>
        <textarea id="bilan2"></textarea>
        <label>3. Mon plus grand d√©fi</label>
        <textarea id="bilan3"></textarea>
        <label>4. Mes prochaines √©tapes d‚Äôapprentissage</label>
        <textarea id="bilan4"></textarea>
        <div class="controls" style="margin-top:12px">
          <button id="saveBilan" class="btn">üíæ Sauvegarder bilan</button>
          <button id="clearBilan" class="btn ghost">üßπ Effacer bilan</button>
        </div>
      </div>
    </main>
  </section>

  <footer>
    D√©velopp√© pour ton projet ‚Ä¢ Exportable vers GitHub Pages ‚Ä¢ Sauvegarde locale automatique
  </footer>

  <script>
    // ----- Storage keys & defaults -----
    const STORAGE_KEY = 'portfolio_algo_v1'
    const BILAN_KEY = 'portfolio_algo_bilan_v1'

    // ----- Initial sample data -----
    const sample = {
      lessons: [
        {id: id(), title: 'Le√ßon 1 ‚Äî Notation Big O', journal:'', synthese:'', application:'', auto:['','', '']},
        {id: id(), title: 'Le√ßon 2 ‚Äî Structures de donn√©es', journal:'', synthese:'', application:'', auto:['','', '']}
      ]
    }

    // ----- State -----
    let data = load() || structuredClone(sample)
    let activeLessonId = data.lessons.length ? data.lessons[0].id : null

    // ----- Elements -----
    const lessonsList = document.getElementById('lessonsList')
    const editorArea = document.getElementById('editorArea')
    const addLessonBtn = document.getElementById('addLessonBtn')
    const exportJsonBtn = document.getElementById('exportJsonBtn')
    const downloadHtmlBtn = document.getElementById('downloadHtmlBtn')
    const resetBtn = document.getElementById('resetBtn')
    const importFile = document.getElementById('importFile')

    const bilanFields = ['bilan1','bilan2','bilan3','bilan4'].map(id=>document.getElementById(id))
    document.getElementById('saveBilan').addEventListener('click',saveBilan)
    document.getElementById('clearBilan').addEventListener('click',clearBilan)

    // ----- Init -----
    renderLessons()
    renderEditor()
    loadBilan()

    // ----- Event bindings -----
    addLessonBtn.addEventListener('click',()=>{
      const title = prompt('Titre de la nouvelle le√ßon (ex: Le√ßon 3 - Tri)') || 'Nouvelle le√ßon'
      const lesson = {id:id(), title, journal:'', synthese:'', application:'', auto:['','', '']}
      data.lessons.push(lesson)
      activeLessonId = lesson.id
      save(); renderLessons(); renderEditor()
    })

    exportJsonBtn.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a'); a.href=url; a.download='portfolio_algo_export.json'; a.click(); URL.revokeObjectURL(url)
    })

    downloadHtmlBtn.addEventListener('click', ()=>{
      const html = buildStandaloneHTML()
      const blob = new Blob([html],{type:'text/html'})
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='portfolio_algo.html'; a.click(); URL.revokeObjectURL(url)
    })

    resetBtn.addEventListener('click',()=>{
      if(!confirm('R√©initialiser le portfolio ? (supprime les donn√©es locales)')) return
      localStorage.removeItem(STORAGE_KEY); localStorage.removeItem(BILAN_KEY); data = structuredClone(sample); activeLessonId = data.lessons[0].id; renderLessons(); renderEditor(); clearBilan()
    })

    importFile.addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return
      const txt = await f.text()
      try{ const parsed = JSON.parse(txt); if(parsed.lessons){data=parsed; save(); renderLessons(); renderEditor(); alert('Import r√©ussi')} else throw '' }catch(err){alert('Fichier non valide')}
      e.target.value = ''
    })

    // ----- Functions -----
    function renderLessons(){
      lessonsList.innerHTML = ''
      data.lessons.forEach(l=>{
        const div = document.createElement('div')
        div.className = 'lesson-item' + (l.id===activeLessonId?' active':'')
        div.textContent = l.title
        div.addEventListener('click',()=>{activeLessonId=l.id; renderLessons(); renderEditor()})
        lessonsList.appendChild(div)
      })
    }

    function renderEditor(){
      const lesson = data.lessons.find(x=>x.id===activeLessonId)
      if(!lesson){ editorArea.innerHTML = '<div class="card"><em>Aucune le√ßon disponible. Cr√©e-en une.</em></div>'; return }
      editorArea.innerHTML = `
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <input id="titleInput" type="text" value="${escapeHtml(lesson.title)}" />
              <div class="small meta">Titre de la le√ßon</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button id="renameBtn" class="btn">üî§ Renommer</button>
              <button id="deleteBtn" class="btn ghost">üóëÔ∏è Supprimer</button>
            </div>
          </div>
          <hr style="margin:14px 0;border:none;border-top:1px solid #f0f6ff" />
          <label>1. Journal d‚Äôapprentissage r√©flexif (5-10 lignes)</label>
          <textarea id="journal">${escapeHtml(lesson.journal||'')}</textarea>

          <label style="margin-top:12px">2. Synth√®se personnelle des concepts cl√©s</label>
          <textarea id="synthese">${escapeHtml(lesson.synthese||'')}</textarea>

          <label style="margin-top:12px">3. Application pratique dans mon contexte</label>
          <textarea id="application">${escapeHtml(lesson.application||'')}</textarea>

          <label style="margin-top:12px">4. Auto‚Äë√©valuation et m√©ta‚Äëcognition</label>
          <div class="row" style="margin-top:8px">
            <div class="col"><label>Ce que je ma√Ætrise bien</label><textarea id="auto1">${escapeHtml(lesson.auto[0]||'')}</textarea></div>
            <div class="col"><label>Ce que je dois am√©liorer</label><textarea id="auto2">${escapeHtml(lesson.auto[1]||'')}</textarea></div>
            <div class="col"><label>Strat√©gie pour progresser</label><textarea id="auto3">${escapeHtml(lesson.auto[2]||'')}</textarea></div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="saveBtn" class="btn">üíæ Sauvegarder le√ßon</button>
            <button id="previewBtn" class="btn ghost">üîç Aper√ßu imprimable</button>
          </div>
        </div>
      `

      // bind actions
      document.getElementById('saveBtn').addEventListener('click', ()=>{
        lesson.title = document.getElementById('titleInput').value || lesson.title
        lesson.journal = document.getElementById('journal').value
        lesson.synthese = document.getElementById('synthese').value
        lesson.application = document.getElementById('application').value
        lesson.auto = [document.getElementById('auto1').value, document.getElementById('auto2').value, document.getElementById('auto3').value]
        save(); renderLessons(); alert('Le√ßon sauvegard√©e')
      })

      document.getElementById('renameBtn').addEventListener('click', ()=>{
        const newTitle = prompt('Nouveau titre', lesson.title);
        if(newTitle){ lesson.title = newTitle; save(); renderLessons(); renderEditor() }
      })

      document.getElementById('deleteBtn').addEventListener('click', ()=>{
        if(!confirm('Supprimer cette le√ßon ?')) return
        data.lessons = data.lessons.filter(x=>x.id!==lesson.id)
        activeLessonId = data.lessons.length ? data.lessons[0].id : null
        save(); renderLessons(); renderEditor()
      })

      document.getElementById('previewBtn').addEventListener('click', ()=>{
        const html = buildPrintable(lesson)
        const w = window.open('', '_blank')
        w.document.write(html); w.document.close()
      })
    }

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)) }
    function load(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) }catch(e){return null} }

    function saveBilan(){
      const b = {bilan1:bilanFields[0].value,bilan2:bilanFields[1].value,bilan3:bilanFields[2].value,bilan4:bilanFields[3].value}
      localStorage.setItem(BILAN_KEY, JSON.stringify(b))
      alert('Bilan sauvegard√©')
    }
    function loadBilan(){ try{const b=JSON.parse(localStorage.getItem(BILAN_KEY)); if(b){bilanFields[0].value=b.bilan1||'';bilanFields[1].value=b.bilan2||'';bilanFields[2].value=b.bilan3||'';bilanFields[3].value=b.bilan4||''}}catch(e){}
    }
    function clearBilan(){ if(!confirm('Effacer le bilan final ?')) return; bilanFields.forEach(f=>f.value=''); localStorage.removeItem(BILAN_KEY) }

    function buildPrintable(lesson){
      return `<!doctype html><html><head><meta charset="utf-8"><title>${escapeHtml(lesson.title)}</title><style>body{font-family:Arial;padding:24px;color:#0b1726}h1{color:#0b5cff}section{margin-bottom:18px}label{font-weight:700}</style></head><body><h1>${escapeHtml(lesson.title)}</h1><section><label>1. Journal d‚Äôapprentissage r√©flexif</label><div>${nl2br(lesson.journal)}</div></section><section><label>2. Synth√®se personnelle</label><div>${nl2br(lesson.synthese)}</div></section><section><label>3. Application pratique</label><div>${nl2br(lesson.application)}</div></section><section><label>4. Auto-√©valuation</label><div><strong>Ce que je ma√Ætrise bien:</strong><div>${nl2br(lesson.auto[0])}</div><strong>Ce que je dois am√©liorer:</strong><div>${nl2br(lesson.auto[1])}</div><strong>Strat√©gie:</strong><div>${nl2br(lesson.auto[2])}</div></div></section></body></html>`
    }

    function buildStandaloneHTML(){
      const payload = JSON.stringify(data)
      const bilan = JSON.stringify({b1:bilanFields[0].value,b2:bilanFields[1].value,b3:bilanFields[2].value,b4:bilanFields[3].value})
      return `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Portfolio Export</title><style>body{font-family:Arial;margin:24px;color:#0b1726}h1{color:#0b5cff}</style></head><body><h1>Portfolio √âvolutif ‚Äî Export</h1><script>const data = ${payload}; const bilan = ${bilan}; document.write('<p>Le portfolio contient '+data.lessons.length+' le√ßon(s).</p>'); data.lessons.forEach((l,i)=>{document.write('<section><h2>'+ (i+1) +'. '+escapeHtml(l.title) +'</h2>'); document.write('<p><strong>Journal:</strong><br/>'+nl2br(l.journal)+'</p>'); document.write('<p><strong>Synth√®se:</strong><br/>'+nl2br(l.synthese)+'</p>'); document.write('<p><strong>Application:</strong><br/>'+nl2br(l.application)+'</p>'); document.write('<p><strong>Auto-√©val:</strong><br/>'+nl2br(l.auto.join('<br/>'))+'</p></section>')}); function nl2br(s){if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/
/g,'<br/>')} function escapeHtml(s){if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</script></body></html>`
    }

    // ----- Helpers -----
    function id(){ return 'l_' + Math.random().toString(36).slice(2,9) }
    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }
    function nl2br(s){ if(!s) return ''; return escapeHtml(s).replace(/
/g,'<br/>') }

  </script>
</body>
</html>
