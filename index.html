<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio √âvolutif ‚Äî Algorithmique & Complexit√©</title>
  <style>
    :root{
      --bg: #ffffff;
      --muted: #f5f6f7;
      --card: #f8f9fa;
      --accent: #2b6cb0;
      --text: #1a202c;
      --muted-text: #4a5568;
      --danger: #e53e3e;
      --radius: 8px;
      --shadow: 0 1px 2px rgba(16,24,40,0.04);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      font-size:16px;
    }

    .app {
      display:flex;
      min-height:100vh;
      gap:24px;
      padding:24px;
      box-sizing:border-box;
    }

    /* Sidebar */
    .sidebar{
      width:320px;
      max-width:38%;
      background:var(--muted);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      gap:12px;
      box-sizing:border-box;
    }

    .brand {
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo {
      width:44px;
      height:44px;
      background:linear-gradient(135deg,var(--accent),#63b3ed);
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:700;
      box-shadow:0 2px 6px rgba(43,108,176,0.18);
    }
    h1{
      margin:0;
      font-size:18px;
      line-height:1;
    }
    .muted {
      color:var(--muted-text);
      font-size:13px;
      margin-top:4px;
    }

    .controls {
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    button {
      background:var(--accent);
      color:white;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      box-shadow:none;
      font-weight:600;
    }
    button.secondary {
      background:transparent;
      color:var(--text);
      border:1px solid rgba(10,10,10,0.04);
      box-shadow:none;
      font-weight:600;
    }
    .list {
      overflow:auto;
      padding-right:6px;
    }
    .lesson-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:10px;
      background:var(--card);
      border-radius:8px;
      margin-bottom:8px;
      cursor:pointer;
      transition:background .12s;
    }
    .lesson-item:hover { background: #eef6ff; }
    .lesson-item.active { outline:2px solid rgba(43,108,176,0.12); background: #e8f3ff; }
    .lesson-title {
      font-weight:600;
    }
    .lesson-meta {
      color:var(--muted-text);
      font-size:12px;
    }
    .small {
      font-size:13px;
    }
    .trash {
      background:transparent;
      border:0;
      color:var(--danger);
      cursor:pointer;
      padding:6px;
      border-radius:6px;
    }

    /* Main area */
    .main {
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .card {
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
    }

    .page-header {
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .title-row {
      display:flex;
      gap:12px;
      align-items:center;
    }

    input.title-input {
      font-size:20px;
      font-weight:700;
      border:0;
      background:transparent;
      outline:none;
      color:var(--text);
      width:420px;
      max-width:60vw;
    }
    input.title-input::placeholder { color:var(--muted-text); font-weight:600; }

    label.field-label {
      display:block;
      font-weight:700;
      margin-bottom:6px;
      color:var(--text);
    }

    textarea.field {
      width:100%;
      min-height:120px;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(10,10,10,0.06);
      resize:vertical;
      background:white;
      box-sizing:border-box;
      color:var(--text);
      font-size:15px;
      font-family:inherit;
    }

    .grid-2 {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }

    .meta-row {
      margin-top:8px;
      color:var(--muted-text);
      font-size:13px;
    }

    .footer-note {
      font-size:13px;
      color:var(--muted-text);
      margin-top:6px;
    }

    /* responsive */
    @media (max-width:900px){
      .app {
        padding:12px;
      }
      .sidebar { display:none; }
      .main { margin-left:0; }
      input.title-input { max-width: calc(100vw - 120px); }
    }

  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div>
        <div class="brand">
          <div class="logo">AC</div>
          <div>
            <h1>Portfolio ‚Äî Algorithmique & Complexit√©</h1>
            <div class="muted">Construisez votre portfolio √©volutif</div>
          </div>
        </div>

        <div class="controls" style="margin-top:12px;">
          <button id="addLessonBtn">Ajouter une le√ßon</button>
          <button class="secondary" id="openBilanBtn">Bilan Final</button>
        </div>
      </div>

      <div style="margin-top:6px;font-size:13px;color:var(--muted-text);">Le√ßons</div>
      <div class="list card" id="lessonsList" style="padding:12px; max-height:60vh;"></div>

      <div class="footer-note card" style="margin-top:auto;">
        Toutes les modifications sont automatiquement enregistr√©es dans votre navigateur (localStorage).
      </div>
    </aside>

    <main class="main" id="main">
      <!-- dynamic content -->
      <div class="card">
        <div class="page-header">
          <div class="title-row">
            <input id="pageTitle" class="title-input" placeholder="S√©lectionnez une le√ßon ou le Bilan Final" readonly />
            <div style="color:var(--muted-text); font-size:14px;" id="pageSubtitle"></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <button id="deleteLessonBtn" style="display:none;" class="secondary">Supprimer la le√ßon</button>
            <button id="exportBtn" class="secondary">Exporter</button>
          </div>
        </div>
      </div>

      <div id="contentArea"></div>
    </main>
  </div>

  <script>
    /* STORAGE KEY */
    const STORAGE_KEY = 'ac_portfolio_v1';

    /* In-memory data */
    let data = {
      lessons: [],
      bilanFinal: {
        appris: '',
        competences: '',
        defis: '',
        prochaines: ''
      },
      selected: null
    };

    /* Debounce timer for saves */
    let saveTimer = null;
    const SAVE_DELAY = 400; // ms

    /* Utility: generate ID */
    function genId(){
      return 'l_' + Date.now().toString(36) + '_' + Math.floor(Math.random()*9000+1000).toString(36);
    }

    /* --- Required functions (exposed globally) --- */

    // Save current in-memory data to localStorage
    function saveData(){
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        // small visual hint could be added here if desired
      } catch (err) {
        console.error('√âchec de l\'enregistrement', err);
      }
    }
    window.saveData = saveData;

    // Load data from localStorage into memory and render UI
    function loadData(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          const parsed = JSON.parse(raw);
          // Basic migration: ensure structure exists
          data = Object.assign({
            lessons: [],
            bilanFinal: {appris:'', competences:'', defis:'', prochaines:''},
            selected: null
          }, parsed);
          if (!Array.isArray(data.lessons)) data.lessons = [];
        } catch (err) {
          console.error('Impossible de parser les donn√©es sauvegard√©es, r√©initialisation.', err);
          data = { lessons: [], bilanFinal:{appris:'',competences:'',defis:'',prochaines:''}, selected: null };
        }
      } else {
        // initialize with a default lesson
        const id = genId();
        data.lessons = [{
          id,
          title: 'Le√ßon 1 ‚Äî Bases',
          journal: '',
          synthese: '',
          application: '',
          maitrise: '',
          ameliorer: '',
          strategie: '',
          updatedAt: Date.now()
        }];
        data.selected = id;
        saveData();
      }

      // If nothing selected, select first lesson or bilan if no lessons
      if (!data.selected) {
        data.selected = data.lessons.length ? data.lessons[0].id : 'bilan';
      }

      renderSidebar();
      renderMain();
    }
    window.loadData = loadData;

    // Create a new lesson and open it
    function createLesson(){
      const id = genId();
      const count = data.lessons.length + 1;
      const lesson = {
        id,
        title: `Le√ßon ${count}`,
        journal: '',
        synthese: '',
        application: '',
        maitrise: '',
        ameliorer: '',
        strategie: '',
        updatedAt: Date.now()
      };
      data.lessons.push(lesson);
      data.selected = id;
      saveData();
      renderSidebar();
      renderMain();
      return id;
    }
    window.createLesson = createLesson;

    // Delete a lesson by id
    function deleteLesson(id){
      const idx = data.lessons.findIndex(l => l.id === id);
      if (idx === -1) return;
      if (!confirm('Supprimer cette le√ßon ? Cette action est irr√©versible.')) return;
      data.lessons.splice(idx,1);
      // if the deleted was selected, select next available or bilan
      if (data.selected === id) {
        data.selected = data.lessons.length ? data.lessons[0].id : 'bilan';
      }
      saveData();
      renderSidebar();
      renderMain();
    }
    window.deleteLesson = deleteLesson;

    /* --- UI rendering & interactions --- */

    const lessonsList = document.getElementById('lessonsList');
    const addLessonBtn = document.getElementById('addLessonBtn');
    const openBilanBtn = document.getElementById('openBilanBtn');
    const pageTitle = document.getElementById('pageTitle');
    const pageSubtitle = document.getElementById('pageSubtitle');
    const contentArea = document.getElementById('contentArea');
    const deleteLessonBtn = document.getElementById('deleteLessonBtn');
    const exportBtn = document.getElementById('exportBtn');

    function renderSidebar(){
      lessonsList.innerHTML = '';

      // render lessons
      data.lessons.forEach(lesson => {
        const el = document.createElement('div');
        el.className = 'lesson-item' + (data.selected === lesson.id ? ' active' : '');
        el.title = lesson.title || 'Le√ßon';
        el.tabIndex = 0;

        const left = document.createElement('div');
        left.style.display = 'flex';
        left.style.flexDirection = 'column';
        left.style.gap = '2px';

        const title = document.createElement('div');
        title.className = 'lesson-title';
        title.textContent = lesson.title || 'Le√ßon';
        left.appendChild(title);

        const meta = document.createElement('div');
        meta.className = 'lesson-meta';
        meta.textContent = lesson.updatedAt ? 'Modifi√© ' + new Date(lesson.updatedAt).toLocaleString() : '';
        left.appendChild(meta);

        el.appendChild(left);

        const right = document.createElement('div');
        right.style.display = 'flex';
        right.style.gap = '6px';
        right.style.alignItems = 'center';

        const del = document.createElement('button');
        del.className = 'trash';
        del.innerHTML = 'üóë';
        del.title = 'Supprimer la le√ßon';
        del.onclick = (ev) => {
          ev.stopPropagation();
          deleteLesson(lesson.id);
        };

        right.appendChild(del);
        el.appendChild(right);

        el.onclick = () => {
          data.selected = lesson.id;
          renderSidebar();
          renderMain();
        };

        el.onkeydown = (e) => {
          if (e.key === 'Enter') el.click();
        };

        lessonsList.appendChild(el);
      });

      // Bilan quick entry at the bottom of the list
      const bilanBtn = document.createElement('div');
      bilanBtn.className = 'lesson-item' + (data.selected === 'bilan' ? ' active' : '');
      bilanBtn.style.marginTop = '8px';
      bilanBtn.tabIndex = 0;
      bilanBtn.onclick = () => {
        data.selected = 'bilan';
        renderSidebar();
        renderMain();
      };
      bilanBtn.innerHTML = '<div><div class="lesson-title">Bilan Final</div><div class="lesson-meta">Synth√®se finale du cours</div></div>';
      lessonsList.appendChild(bilanBtn);
    }

    function renderMain(){
      // Update title area
      if (data.selected === 'bilan') {
        pageTitle.value = 'Bilan Final';
        pageTitle.readOnly = true;
        pageSubtitle.textContent = 'Synth√®se finale et prochaines √©tapes';
        deleteLessonBtn.style.display = 'none';
        // render bilan page
        renderBilan();
      } else {
        const lesson = data.lessons.find(l => l.id === data.selected);
        if (!lesson) {
          pageTitle.value = '';
          pageTitle.placeholder = 'S√©lectionnez une le√ßon';
          pageSubtitle.textContent = '';
          contentArea.innerHTML = '<div class="card small">Aucune le√ßon s√©lectionn√©e.</div>';
          deleteLessonBtn.style.display = 'none';
          return;
        }
        pageTitle.readOnly = false;
        pageTitle.value = lesson.title || 'Le√ßon';
        pageSubtitle.textContent = 'Derni√®re modification: ' + (lesson.updatedAt ? new Date(lesson.updatedAt).toLocaleString() : '‚Äî');
        deleteLessonBtn.style.display = 'inline-block';
        deleteLessonBtn.onclick = () => deleteLesson(lesson.id);
        // render lesson page
        renderLesson(lesson);
      }
    }

    function renderLesson(lesson){
      contentArea.innerHTML = '';

      // Journal d‚Äôapprentissage r√©flexif
      const cardJournal = document.createElement('div');
      cardJournal.className = 'card';
      cardJournal.innerHTML = `
        <label class="field-label">Journal d'apprentissage r√©flexif</label>
        <div class="small" style="margin-bottom:8px;color:var(--muted-text)">
          √âcrivez 5‚Äì10 lignes sur ce que vous avez appris, vos succ√®s, difficult√©s et ressentis.
        </div>
        <textarea class="field" data-field="journal" placeholder="Mon journal..."></textarea>
      `;
      contentArea.appendChild(cardJournal);

      // Synth√®se personnelle
      const cardSynth = document.createElement('div');
      cardSynth.className = 'card';
      cardSynth.innerHTML = `
        <label class="field-label">Synth√®se personnelle des concepts cl√©s</label>
        <div class="small" style="margin-bottom:8px;color:var(--muted-text)">
          R√©sumez les principaux concepts dans vos propres mots.
        </div>
        <textarea class="field" data-field="synthese" placeholder="Synth√®se..."></textarea>
      `;
      contentArea.appendChild(cardSynth);

      // Application pratique
      const cardApp = document.createElement('div');
      cardApp.className = 'card';
      cardApp.innerHTML = `
        <label class="field-label">Application pratique dans mon contexte</label>
        <div class="small" style="margin-bottom:8px;color:var(--muted-text)">
          Comment appliquez-vous ces concepts dans vos √©tudes, travail ou projets personnels ?
        </div>
        <textarea class="field" data-field="application" placeholder="Application..."></textarea>
      `;
      contentArea.appendChild(cardApp);

      // Auto-√©valuation et m√©ta-cognition (3 fields)
      const cardMeta = document.createElement('div');
      cardMeta.className = 'card';
      cardMeta.innerHTML = `
        <label class="field-label">Auto-√©valuation et m√©ta-cognition</label>
        <div class="grid-2" style="margin-top:8px;">
          <div>
            <label class="field-label">Ce que je ma√Ætrise bien :</label>
            <textarea class="field" data-field="maitrise" placeholder="Ce que je ma√Ætrise..."></textarea>
          </div>
          <div>
            <label class="field-label">Ce que je dois am√©liorer :</label>
            <textarea class="field" data-field="ameliorer" placeholder="Ce que je dois am√©liorer..."></textarea>
          </div>
        </div>
        <div style="margin-top:12px;">
          <label class="field-label">Strat√©gie pour progresser :</label>
          <textarea class="field" data-field="strategie" placeholder="Ma strat√©gie..."></textarea>
        </div>
      `;
      contentArea.appendChild(cardMeta);

      // Bind values and events
      // Title input binding
      pageTitle.oninput = (e) => {
        lesson.title = e.target.value;
        lesson.updatedAt = Date.now();
        scheduleSave();
        renderSidebar(); // update list titles
      };

      // textareas
      const areas = contentArea.querySelectorAll('textarea.field');
      areas.forEach(area => {
        const field = area.getAttribute('data-field');
        area.value = lesson[field] || '';
        area.oninput = (e) => {
          lesson[field] = e.target.value;
          lesson.updatedAt = Date.now();
          scheduleSave();
          // update subtitle
          pageSubtitle.textContent = 'Derni√®re modification: ' + new Date(lesson.updatedAt).toLocaleString();
        };
      });
    }

    function renderBilan(){
      contentArea.innerHTML = '';
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;">
          <div>
            <label class="field-label">Ce que j‚Äôai le plus appris dans ce cours</label>
            <textarea class="field" data-field="appris" placeholder="Ce que j'ai appris..."></textarea>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label class="field-label">Les comp√©tences que je peux r√©utiliser ailleurs</label>
          <textarea class="field" data-field="competences" placeholder="Comp√©tences r√©utilisables..."></textarea>
        </div>

        <div style="margin-top:12px;">
          <label class="field-label">Mon plus grand d√©fi</label>
          <textarea class="field" data-field="defis" placeholder="Mon d√©fi..."></textarea>
        </div>

        <div style="margin-top:12px;">
          <label class="field-label">Mes prochaines √©tapes d'apprentissage</label>
          <textarea class="field" data-field="prochaines" placeholder="Prochaines √©tapes..."></textarea>
        </div>
      `;
      contentArea.appendChild(card);

      // Bind values/events
      const fields = card.querySelectorAll('textarea.field');
      fields.forEach(area => {
        const f = area.getAttribute('data-field');
        area.value = data.bilanFinal[f] || '';
        area.oninput = (e) => {
          data.bilanFinal[f] = e.target.value;
          scheduleSave();
        };
      });
    }

    /* Save scheduling (debounced) */
    function scheduleSave(){
      if (saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        saveData();
        saveTimer = null;
      }, SAVE_DELAY);
    }

    /* Buttons */
    addLessonBtn.onclick = () => createLesson();
    openBilanBtn.onclick = () => {
      data.selected = 'bilan';
      renderSidebar();
      renderMain();
    };

    exportBtn.onclick = () => {
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'portfolio_ac_export.json';
      a.click();
      URL.revokeObjectURL(url);
    };

    /* Ensure data saved on unload */
    window.addEventListener('beforeunload', () => {
      if (saveTimer) clearTimeout(saveTimer);
      saveData();
    });

    /* Initialize */
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
    });

    /* Expose functions for console usage */
    window._portfolio_data = data;
    window._storageKey = STORAGE_KEY;

  </script>
</body>
</html>
